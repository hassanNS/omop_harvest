define(["backbone","../core","../base","../accordion"],function(t,e,i,n){var s=n.AccordionItem.extend({events:{"click a":"click"},initialize:function(){this.listenTo(e,e.CONCEPT_FOCUS,this.toggleFocus)},click:function(t){t.preventDefault(),e.trigger(e.CONCEPT_FOCUS,this.model.id)},toggleFocus:function(t){this.$el.toggleClass("active",t===this.model.id)}}),o=n.AccordionSection.extend({itemView:s,filter:function(t,e){var i=!1;return this.children.each(function(n){!t||e[n.model.id]?(n.$el.show(),i=!0):n.$el.hide()}),this.$el.toggle(i),i}}),r=n.AccordionGroup.extend({itemView:o,filter:function(t,e){var i=!1;return this.children.each(function(n){n.filter(t,e)&&(i=!0)}),t?i?(this.$el.show(),this.renderExpanded()):this.$el.hide():(this.$el.show(),this.renderState()),i},find:function(t){var e,i,n;for(e in this.children._views)if(i=this.children._views[e],i.children&&(n=i.children.findByModel(t)))return n}}),a=n.Accordion.extend({className:"concept-index accordion",itemView:r,emptySearchView:i.EmptySearchView,showCollection:function(){this.resetGroups();var t=this;this.groups.each(function(e,i){t.addItemView(e,t.getItemView(e),i)})},getGroup:function(t){if(t.category){for(var e=t.category;e.parent;)e=e.parent;return e}return{id:-1,name:"Other"}},getSection:function(t){return t.category&&t.category.parent?t.category:{id:-1,name:"Other"}},resetGroups:function(){this.groups?this.groups.reset():this.groups=new t.Collection(null,{comparator:"order"});var e=this;this.collection.each(function(t){e.groupModel(t)})},groupModel:function(e){var i=this.getGroup(e.attributes),n=this.getSection(e.attributes),s=this.groups.get(i.id);s||(s=new t.Model(i),s.sections=new t.Collection(null,{comparator:"order"}),this.groups.add(s));var o=s.sections.get(n.id);o||(o=new t.Model(n),o.items=new t.Collection(null,{comparator:"order"}),s.sections.add(o)),o.items.add(e)},filter:function(t,e){var i={};if(t){var n,s,o;for(n=0;n<e.length;n++)s=e[n],(o=this.collection.get(s.id))&&(i[o.id]=o)}var r=!1;return this.children.each(function(e){e.filter(t,i)&&(r=!0)}),r?this.closeEmptySearchView():this.showEmptySearchView(t),r},find:function(t){var e,i,n;for(e in this.children._views)if(i=this.children._views[e],n=i.find(t))return n},showEmptySearchView:function(t){this.closeEmptySearchView(),this._emptyView=new this.emptySearchView({message:'<p>We could not find anything related to "'+t+'"</p>'}),this.$el.append(this._emptyView.render().el)},closeEmptySearchView:function(){this._emptyView&&(this._emptyView.remove(),delete this._emptyView)}});return{ConceptIndex:a,ConceptGroup:r,ConceptSection:o,ConceptItem:s}});
//@ sourceMappingURL=index.js.map