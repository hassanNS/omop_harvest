define(["underscore","backbone","../core","./base"],function(t,e,i,n){var s=e.Model.extend({idAttribute:"concept"}),o=e.Collection.extend({model:s}),r=n.Model.extend({constructor:function(){this.facets=new o,this.on("change:json",function(t,e){return this.jsonToFacets(e)}),n.Model.prototype.constructor.apply(this,arguments)},initialize:function(){var t=this;return this.on("request",function(){return i.trigger(i.VIEW_SYNCING,this)}),this.on("sync",function(t,e,n){return n||(n={}),n.silent!==!0?i.trigger(i.VIEW_SYNCED,this,"success"):void 0}),this.on("error",function(){return i.trigger(i.VIEW_SYNCED,this,"error")}),this.on("change",function(){return i.trigger(i.VIEW_CHANGED,this)}),i.on(i.VIEW_SAVE,function(e){return t.id===e||!e&&t.isSession()?t.save():void 0})},isSession:function(){return this.get("session")},isArchived:function(){return this.get("archived")},toJSON:function(){var t=n.Model.prototype.toJSON.apply(this,arguments);return t.json=this.facetsToJSON(),t},parse:function(t){return n.Model.prototype.parse.apply(this,arguments),this.jsonToFacets(t.json),t},jsonToFacets:function(e){if(e||(e={}),t.isArray(e))return this.facets.reset(e),void 0;for(var i,n,s,o=[],r=e.columns||[],a=e.ordering||[],h=0;h<r.length;h++){n=r[h],i={concept:n};for(var l=0;l<a.length;l++)s=a[l],n===s[0]&&(i.sort=s[1],i.sort_index=l);o.push(i)}return this.facets.reset(o)},facetsToJSON:function(){var t={ordering:[],columns:[]};return this.facets.each(function(e){var i,n,s;return t.columns.push(e.get("concept")),(i=e.get("sort"))?(n=e.get("sort_index"),s=[e.get("concept"),i],t.ordering.splice(n,0,s)):void 0}),t}}),a=n.SessionCollection.extend({model:r});return{ViewModel:r,ViewCollection:a}});
//@ sourceMappingURL=view.js.map