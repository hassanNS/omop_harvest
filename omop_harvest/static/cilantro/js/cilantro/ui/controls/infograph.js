var __hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},__bind=function(t,e){return function(){return t.apply(e,arguments)}},__indexOf=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1},__slice=[].slice;define(["underscore","backbone","marionette","./base","../button"],function(t,e,i,n){var o,s,r,a,l,c,u,h,d,p,f,g;return u=function(e){return function(i){var n;return n=i.get(e),t.isString(n)&&(n=n.toLowerCase()),n}},a=function(t){function e(){return h=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.parse=function(t){return t.value=t.values[0],t},e}(e.Model),r=function(t){function e(){return d=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.model=a,e.prototype.comparator=function(t){return-t.get("count")},e.prototype.sortModelsBy=function(t){var e;(e="-"===t.charAt(0))&&(t=t.slice(1)),this.models=this.sortBy(u(t)),e&&this.models.reverse(),this.trigger("sort",this)},e}(e.Collection),o=function(t){function e(){return this.onExcludedChange=__bind(this.onExcludedChange,this),p=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.className="info-bar",e.prototype.template="controls/infograph/bar",e.prototype.options={total:null},e.prototype.ui={bar:".bar",barLabel:".bar-label"},e.prototype.events={click:"toggleSelected"},e.prototype.modelEvents={"change:selected":"setSelected","change:visible":"setVisible"},e.prototype.initialize=function(){return this.listenTo(this.model.collection,"change:excluded",this.onExcludedChange)},e.prototype.serializeData=function(){var t,e;return t=this.model.toJSON(),t.value=t.values[0],e=this.getPercentage(),t.width=e,t.percentage=1>e?"<1":parseInt(e),t},e.prototype.onRender=function(){return this.setSelected(this.model,!!this.model.get("selected")),""===this.ui.barLabel.html()&&this.ui.barLabel.html("(empty)"),"null"===this.ui.barLabel.html()?this.ui.barLabel.html("(null)"):void 0},e.prototype.getPercentage=function(){return 100*(this.model.get("count")/this.options.total)},e.prototype.toggleSelected=function(){return this.model.set("selected",!this.model.get("selected"))},e.prototype.onExcludedChange=function(){return this.$el.toggleClass("excluded",this.model.get("excluded"))},e.prototype.setSelected=function(t,e){return this.$el.toggleClass("selected",e),e||t.get("visible")!==!1?void 0:this.$el.removeClass("filtered").hide()},e.prototype.setVisible=function(t,e){return e?this.$el.removeClass("filtered").show():t.get("selected")?this.$el.addClass("filtered"):this.$el.hide()},e}(i.ItemView),l=function(e){function i(){return f=i.__super__.constructor.apply(this,arguments)}return __extends(i,e),i.prototype.className="info-bar-chart",i.prototype.itemView=o,i.prototype.itemViewOptions=function(t){return{model:t,total:this.calcTotal()}},i.prototype.collectionEvents={change:"change",sort:"sortChildren"},i.prototype.initialize=function(){var t=this;return this.wait(),this.model.distribution(function(e){return t.collection.reset(e.data,{parse:!0}),t.ready()})},i.prototype.calcTotal=function(){var t,e,i,n,o;for(e=0,o=this.collection.pluck("count"),i=0,n=o.length;n>i;i++)t=o[i],e+=t;return e},i.prototype.sortChildren=function(){var t=this;this.collection.each(function(e){var i;return i=t.children.findByModel(e),t.$el.append(i.el)})},i.prototype.getField=function(){return this.model.id},i.prototype.getOperator=function(){return this.collection.where({excluded:!0}).length>0?"-in":"in"},i.prototype.getValue=function(){return t.map(this.collection.where({selected:!0}),function(t){return t.get("value")})},i.prototype.setValue=function(t){null==t&&(t=[]),this.collection.each(function(e){var i;return e.set("selected",(i=e.get("value"),__indexOf.call(t,i)>=0))})},i.prototype.setOperator=function(t){"-in"===t&&(this.collection.each(function(t){return t.set("excluded",!0)}),$("input[name=exclude]").attr("checked",!0))},i}(n.ControlCollectionView),s=function(e){function i(){return this.toggle=__bind(this.toggle,this),g=i.__super__.constructor.apply(this,arguments)}return __extends(i,e),i.prototype.className="navbar navbar-toolbar",i.prototype.template="controls/infograph/toolbar",i.prototype.events={"keyup [name=filter]":"filterBars","click [name=invert]":"invertSelection","click .sort-value-header, .sort-count-header":"sortBy","change [name=exclude]":"excludeCheckboxChanged"},i.prototype.ui={toolbar:".btn-toolbar",filterInput:"[name=filter]",invertButton:"[name=invert]",sortValueHeader:".sort-value-header",sortCountHeader:".sort-count-header",excludeCheckbox:"[name=exclude]"},i.prototype.initialize=function(){return this.sortDirection="-count"},i.prototype.sortBy=function(t){switch(this.sortDirection="sort-value-header"===t.currentTarget.className?"-value"===this.sortDirection?"value":"-value":"-count"===this.sortDirection?"count":"-count",this.sortDirection){case"-count":this.ui.sortValueHeader.html("Value <i class=icon-sort></i>"),this.ui.sortCountHeader.html("Count <i class=icon-sort-down></i>");break;case"count":this.ui.sortValueHeader.html("Value <i class=icon-sort></i>"),this.ui.sortCountHeader.html("Count <i class=icon-sort-up></i>");break;case"-value":this.ui.sortValueHeader.html("Value <i class=icon-sort-down></i>"),this.ui.sortCountHeader.html("Count <i class=icon-sort></i>");break;case"value":this.ui.sortValueHeader.html("Value <i class=icon-sort-up></i>"),this.ui.sortCountHeader.html("Count <i class=icon-sort></i>")}return this.collection.sortModelsBy(this.sortDirection)},i.prototype.toggle=function(t){return this.ui.filterInput.toggle(t),this.ui.invertButton.toggle(t),this.ui.sortValueHeader.toggle(t),this.ui.sortCountHeader.toggle(t)},i.prototype.filterBars=function(e){var i,n;t.isString(e)?n=e:(null!=e&&e.stopPropagation(),n=this.ui.filterInput.val()),i=new RegExp(n,"i"),this.collection.each(function(t){return t.set("visible",!n||i.test(t.get("value")))})},i.prototype.invertSelection=function(){this.collection.each(function(t){return t.get("visible")!==!1||t.get("selected")?t.set("selected",!t.get("selected")):void 0}),this.collection.trigger("change")},i.prototype.excludeCheckboxChanged=function(){var t=this;this.collection.each(function(e){return e.set("excluded",t.ui.excludeCheckbox.prop("checked"),{silent:!0})}),this.collection.trigger("change:excluded")},i}(i.ItemView),c=function(e){function i(t){this.toggleToolbar=__bind(this.toggleToolbar,this);var e,n,o,s,a,c=this;for(null==t.collection&&(t.collection=new r),i.__super__.constructor.call(this,t),this.barsControl=new l({model:this.model,collection:this.collection}),a=["set","get","when","ready","wait"],n=function(t){return c[t]=function(){var e,i;return e=1<=arguments.length?__slice.call(arguments,0):[],(i=c.barsControl)[t].apply(i,e)}},o=0,s=a.length;s>o;o++)e=a[o],n(e);this.listenTo(this.barsControl,"all",function(){var t,e;return e=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],("change"===e||"beforeready"===e||"ready"===e)&&this.trigger.apply(this,[e].concat(__slice.call(t))),"ready"===e?this.ui.loading.hide():void 0})}return __extends(i,e),i.prototype.template="controls/infograph/layout",i.prototype.events={change:"change"},i.prototype.options={minValuesForToolbar:10},i.prototype.regions={bars:".bars-region",toolbar:".toolbar-region"},i.prototype.ui={loading:"[data-target=loading-indicator]"},i.prototype.collectionEvents={reset:"toggleToolbar"},i.prototype.toggleToolbar=function(){return this.toolbar.currentView?this.toolbar.currentView.toggle(this.collection.length>=this.options.minValuesForToolbar):void 0},i.prototype.onRender=function(){return this.bars.show(this.barsControl),this.toolbar.show(new s({collection:this.collection})),this.toggleToolbar()},i.prototype.validate=function(e){return t.isUndefined(e.value)||0===e.value.length?"Select at least one value":void 0},i}(n.ControlLayout),{InfographControl:c}});
//@ sourceMappingURL=infograph.js.map